{% load humanize %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>RIDE Factura</title>
    <style>
        @page {
            size: A4;
            margin: 10mm;
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 11px;
            color: #333;
            line-height: 1.3;
        }

        .header {
            width: 100%;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            padding: 10px;
        }

        .header-table {
            width: 100%;
            border-collapse: collapse;
        }

        .logo-box {
            width: 45%;
            vertical-align: top;
            text-align: center;
        }

        .info-box {
            width: 55%;
            vertical-align: top;
            padding-left: 20px;
        }

        .box-title {
            font-size: 14px;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .ruc-box {
            border: 1px solid #000;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .clave-acceso {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            letter-spacing: 1px;
            word-break: break-all;
        }

        .client-info {
            width: 100%;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 15px;
        }

        .table-details {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .table-details th,
        .table-details td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: left;
        }

        .table-details th {
            background-color: #f5f5f5;
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .totals-section {
            width: 100%;
            margin-top: 10px;
        }

        .totals-table {
            width: 40%;
            float: right;
            border-collapse: collapse;
        }

        .totals-table td {
            border: 1px solid #ccc;
            padding: 5px;
        }

        .footer-note {
            clear: both;
            margin-top: 50px;
            font-size: 10px;
            color: #777;
            text-align: center;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        .logo-img {
            max-width: 180px;
            max-height: 100px;
        }
    </style>
</head>

<body>

    <!-- CABECERA PRINCIPAL -->
    <div class="header">
        <table class="header-table">
            <tr>
                <td class="logo-box">
                    {% if logo_url %}
                    <img src="{{ logo_url }}" class="logo-img" alt="Logo Junta">
                    {% else %}
                    <h1>JUNTA DE AGUA</h1>
                    <p>El Arbolito</p>
                    {% endif %}
                    <br><br>
                    <small>Dirección Matriz: {{ emisor.direccion }}</small><br>
                    <small>Obligado a llevar contabilidad: {{ emisor.obligado }}</small>
                </td>
                <td class="info-box">
                    <div class="ruc-box">
                        <span class="box-title">R.U.C.: {{ emisor.ruc }}</span>
                        <span class="box-title">FACTURA</span>
                        <br>
                        No. {{ factura.numero_completo }}<br>
                        NÚMERO DE AUTORIZACIÓN:<br>
                        <span class="clave-acceso">{{ factura.clave_acceso }}</span>
                        <br><br>
                        FECHA Y HORA DE AUTORIZACIÓN:<br>
                        {{ factura.fecha_autorizacion|date:"d/m/Y H:i" }}<br>
                        <br>
                        AMBIENTE: {{ emisor.ambiente }}<br>
                        EMISIÓN: NORMAL
                    </div>
                </td>
            </tr>
        </table>

        <!-- BARRAS CLAVE ACCESO (Simulado Texto) -->
        <div style="margin-top: 5px; text-align: center;">
            <small>CLAVE DE ACCESO</small><br>
            <span class="clave-acceso" style="font-weight: bold; font-size: 11px;">{{ factura.clave_acceso }}</span>
        </div>
    </div>

    <!-- DATOS CLIENTE -->
    <div class="client-info">
        <table style="width: 100%;">
            <tr>
                <td width="15%"><b>Razón Social:</b></td>
                <td width="50%">{{ cliente.nombre }}</td>
                <td width="15%"><b>Identificación:</b></td>
                <td width="20%">{{ cliente.identificacion }}</td>
            </tr>
            <tr>
                <td><b>Fecha Emisión:</b></td>
                <td>{{ factura.fecha_emision }}</td>
                <td><b>Dirección:</b></td>
                <td>{{ cliente.direccion }}</td>
            </tr>
        </table>
    </div>

    <!-- DETALLES -->
    <table class="table-details">
        <thead>
            <tr>
                <th width="10%">Cod.</th>
                <th width="10%">Cant.</th>
                <th width="45%">Descripción</th>
                <th width="15%">P. Unitario</th>
                <th width="10%">Desc.</th>
                <th width="10%">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in detalles %}
            <tr>
                <td class="text-center">{{ forloop.counter }}</td>
                <td class="text-center">{{ item.cantidad }}</td>
                <td>{{ item.concepto }}</td>
                <td class="text-right">{{ item.precio_unitario|floatformat:4 }}</td>
                <td class="text-right">0.00</td>
                <td class="text-right">{{ item.subtotal|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- TOTALES -->
    <div class="totals-section">
        <!-- INFO ADICIONAL (Izquierda) -->
        <div style="width: 55%; float: left; border: 1px solid #ddd; padding: 10px;">
            <b>Información Adicional:</b><br>
            <ul style="list-style: none; padding-left: 0; font-size: 10px;">
                <li><b>Email:</b> {{ cliente.email }}</li>
                <li><b>Teléfono:</b> {{ cliente.telefono }}</li>
                {% if factura.lectura %}
                <li><b>Lectura Actual:</b> {{ factura.lectura.valor }} m³</li>
                <li><b>Consumo Mes:</b> {{ factura.lectura.consumo }} m³</li>
                {% endif %}
            </ul>
        </div>

        <!-- CALCULOS (Derecha) -->
        <table class="totals-table">
            <tr>
                <td><b>Subtotal 15%</b></td>
                <td class="text-right">0.00</td>
            </tr>
            <tr>
                <td><b>Subtotal 0%</b></td>
                <td class="text-right">{{ factura.subtotal|floatformat:2 }}</td>
            </tr>
            <tr>
                <td><b>Subtotal No Objeto</b></td>
                <td class="text-right">0.00</td>
            </tr>
            <tr>
                <td><b>Descuento Total</b></td>
                <td class="text-right">0.00</td>
            </tr>
            <tr>
                <td><b>IVA 15%</b></td>
                <td class="text-right">0.00</td>
            </tr>
            <tr>
                <td style="background-color: #eee;"><b>VALOR TOTAL</b></td>
                <td class="text-right" style="font-weight: bold;">{{ factura.total|floatformat:2 }}</td>
            </tr>
        </table>
    </div>

    <div class="footer-note">
        Documento generado electrónicamente por Facturación SRI v2.0
    </div>

</body>

</html>